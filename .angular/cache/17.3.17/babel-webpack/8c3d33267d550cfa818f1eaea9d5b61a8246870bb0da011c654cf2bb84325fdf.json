{"ast":null,"code":"import { __awaiter as e } from \"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";\nimport { isSdkError as n, ErrorCode as t } from \"../public/interfaces.js\";\nimport { latestRuntimeApiVersion as o } from \"../public/runtime.js\";\nimport { isSerializable as r } from \"../public/serializable.interface.js\";\nimport { UUID as i } from \"../public/uuidObject.js\";\nimport { version as s } from \"../public/version.js\";\nimport { uninitializeChildCommunication as a, shouldProcessChildMessage as c, handleIncomingMessageFromChild as d } from \"./childCommunication.js\";\nimport { getMessageIdsAsLogString as u, flushMessageQueue as l } from \"./communicationUtils.js\";\nimport { GlobalVars as g } from \"./globalVars.js\";\nimport { callHandler as p } from \"./handlers.js\";\nimport f from \"./hostToAppTelemetry.js\";\nimport { serializeMessageRequest as m, deserializeMessageResponse as w } from \"./messageObjects.js\";\nimport { tryPolyfillWithNestedAppAuthBridge as h } from \"./nestedAppAuthUtils.js\";\nimport { getLogger as v, isFollowingApiVersionTagFormat as b } from \"./telemetry.js\";\nimport { getCurrentTimestamp as W, ssrSafeWindow as M } from \"./utils.js\";\nimport { validateOrigin as y } from \"./validOrigins.js\";\nconst k = v(\"communication\");\nclass I {}\nclass T {}\nfunction E(n, t) {\n  if (T.messageListener = n => function (n) {\n    return e(this, void 0, void 0, function* () {\n      if (!n || !n.data || \"object\" != typeof n.data) return void J(\"Unrecognized message format received by app, message being ignored. Message: %o\", n);\n      const e = n.source || n.originalEvent && n.originalEvent.source,\n        t = n.origin || n.originalEvent && n.originalEvent.origin;\n      return B(e, t).then(o => {\n        o ? (!function (e, n) {\n          g.isFramelessWindow || I.parentWindow && !I.parentWindow.closed && e !== I.parentWindow || (I.parentWindow = e, I.parentOrigin = n);\n          I.parentWindow && I.parentWindow.closed && (I.parentWindow = null, I.parentOrigin = null);\n          l(I.parentWindow, I.parentOrigin, T.parentMessageQueue, \"parent\");\n        }(e, t), e !== I.parentWindow ? c(e, t) && d(n, e, V, (e, n) => T.callbacks.set(e, n)) : Y(n)) : J(\"Message being ignored by app because it is either coming from the current window or a different window with an invalid origin, message: %o, source: %o, origin: %o\", n, e, t);\n      });\n    });\n  }(n), I.currentWindow = I.currentWindow || M(), I.parentWindow = I.currentWindow.parent !== I.currentWindow.self ? I.currentWindow.parent : I.currentWindow.opener, I.topWindow = I.currentWindow.top, (I.parentWindow || n) && I.currentWindow.addEventListener(\"message\", T.messageListener, !1), !I.parentWindow) {\n    const e = I.currentWindow;\n    if (!e.nativeInterface) return Promise.reject(new Error(\"Initialization Failed. No Parent window found.\"));\n    g.isFramelessWindow = !0, e.onNativeMessage = Y;\n  }\n  try {\n    return I.parentOrigin = \"*\", S(t, \"initialize\", [s, o, n]).then(([e, n, t, o]) => (h(o, I.currentWindow, {\n      onMessage: D,\n      sendPostMessage: L\n    }), {\n      context: e,\n      clientType: n,\n      runtimeConfig: t,\n      clientSupportedSDKVersion: o\n    }));\n  } finally {\n    I.parentOrigin = null;\n  }\n}\nfunction j() {\n  I.currentWindow && I.currentWindow.removeEventListener(\"message\", T.messageListener, !1), I.currentWindow = null, I.parentWindow = null, I.parentOrigin = null, T.parentMessageQueue = [], T.nextMessageId = 0, T.callbacks.clear(), T.promiseCallbacks.clear(), T.portCallbacks.clear(), T.legacyMessageIdsToUuidMap = {}, f.clearMessages(), a();\n}\nfunction O(e, n, ...t) {\n  return S(e, n, t).then(([e]) => e);\n}\nfunction R(e, n, ...t) {\n  return S(e, n, t).then(([e, n]) => {\n    if (!e) throw new Error(n);\n  });\n}\nfunction C(e, n, t, ...o) {\n  return S(e, n, o).then(([e, n]) => {\n    if (!e) throw new Error(n || t);\n  });\n}\nfunction P(e, n, ...t) {\n  return S(e, n, t).then(([e, n]) => {\n    if (e) throw e;\n    return n;\n  });\n}\nfunction S(e, n, t = void 0) {\n  if (!b(e)) throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);\n  return new Promise(o => {\n    const r = V(e, n, t);\n    var i;\n    o((i = r.uuid, new Promise(e => {\n      T.promiseCallbacks.set(i, e);\n    })));\n  });\n}\nfunction x(e) {\n  return e.map(e => r(e) ? e.serialize() : e);\n}\nfunction N(o, r, i, s, a) {\n  var c;\n  return e(this, void 0, void 0, function* () {\n    const e = x(r),\n      [d] = yield S(s, o, e);\n    if (a && a(d) || !a && n(d)) throw new Error(`${d.errorCode}, message: ${null !== (c = d.message) && void 0 !== c ? c : \"None\"}`);\n    if (i.validate(d)) return i.deserialize(d);\n    throw new Error(`${t.INTERNAL_ERROR}, message: Invalid response from host - ${JSON.stringify(d)}`);\n  });\n}\nfunction A(o, r, i, s) {\n  var a;\n  return e(this, void 0, void 0, function* () {\n    const e = x(r),\n      [c] = yield S(i, o, e);\n    if (s && s(c) || !s && n(c)) throw new Error(`${c.errorCode}, message: ${null !== (a = c.message) && void 0 !== a ? a : \"None\"}`);\n    if (void 0 !== c) throw new Error(`${t.INTERNAL_ERROR}, message: Invalid response from host`);\n  });\n}\nfunction U(e, n, t = void 0) {\n  if (!b(e)) throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);\n  const o = V(e, n, t);\n  return r = o.uuid, new Promise((e, n) => {\n    T.portCallbacks.set(r, (t, o) => {\n      t instanceof MessagePort ? e(t) : n(o && o.length > 0 ? o[0] : new Error(\"Host responded without port or error details.\"));\n    });\n  });\n  var r;\n}\nfunction $(e, n, t, o) {\n  let r;\n  if (t instanceof Function ? o = t : t instanceof Array && (r = t), !b(e)) throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);\n  const i = V(e, n, r);\n  o && T.callbacks.set(i.uuid, o);\n}\nT.parentMessageQueue = [], T.topMessageQueue = [], T.nextMessageId = 0, T.callbacks = new Map(), T.promiseCallbacks = new Map(), T.portCallbacks = new Map(), T.legacyMessageIdsToUuidMap = {};\nconst z = k.extend(\"sendNestedAuthRequestToTopWindow\");\nfunction L(e, n) {\n  const t = z,\n    o = I.topWindow,\n    r = function (e, n) {\n      const t = T.nextMessageId++,\n        o = new i();\n      return T.legacyMessageIdsToUuidMap[t] = o, {\n        id: t,\n        uuid: o,\n        func: \"nestedAppAuth.execute\",\n        timestamp: Date.now(),\n        monotonicTimestamp: W(),\n        apiVersionTag: n,\n        args: [],\n        data: e\n      };\n    }(e, n);\n  return t(\"Message %s information: %o\", u(r), {\n    actionName: r.func\n  }), F(o, r);\n}\nconst _ = k.extend(\"sendRequestToTargetWindowHelper\");\nfunction F(e, n) {\n  const t = _,\n    o = function (e) {\n      return e === I.topWindow && Z() ? \"top\" : e === I.parentWindow ? \"parent\" : null;\n    }(e),\n    r = m(n);\n  if (g.isFramelessWindow) I.currentWindow && I.currentWindow.nativeInterface && (t(\"Sending message %s to %s via framelessPostMessage interface\", u(r), o), I.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(r)));else {\n    const i = function (e) {\n      return e === I.topWindow && Z() ? I.topOrigin : e === I.parentWindow ? I.parentOrigin : null;\n    }(e);\n    e && i ? (t(\"Sending message %s to %s via postMessage\", u(r), o), e.postMessage(r, i)) : (t(\"Adding message %s to %s message queue\", u(r), o), ee(e).push(n));\n  }\n  return n;\n}\nconst Q = k.extend(\"sendMessageToParentHelper\");\nfunction V(e, n, t, o, r) {\n  const s = Q,\n    a = I.parentWindow,\n    c = function (e, n, t, o, r) {\n      const s = T.nextMessageId++,\n        a = new i();\n      T.legacyMessageIdsToUuidMap[s] = a;\n      const c = !0 === o ? r : g.teamsJsInstanceId;\n      return {\n        id: s,\n        uuid: a,\n        func: n,\n        timestamp: Date.now(),\n        monotonicTimestamp: W(),\n        args: t || [],\n        apiVersionTag: e,\n        isProxiedFromChild: null != o && o,\n        teamsJsInstanceId: c\n      };\n    }(e, n, t, o, r);\n  return f.storeCallbackInformation(c.uuid, {\n    name: n,\n    calledAt: c.timestamp\n  }), s(\"Message %s information: %o\", u(c), {\n    actionName: n,\n    args: t\n  }), F(a, c);\n}\nconst J = k.extend(\"processIncomingMessage\");\nconst q = k.extend(\"processAuthBridgeMessage\");\nfunction D(e, n) {\n  var t, o;\n  const r = q;\n  if (!e || !e.data || \"object\" != typeof e.data) return void r(\"Unrecognized message format received by app, message being ignored. Message: %o\", e);\n  const {\n      args: i\n    } = e.data,\n    [, s] = null != i ? i : [],\n    a = (() => {\n      try {\n        return JSON.parse(s);\n      } catch (e) {\n        return null;\n      }\n    })();\n  if (!a || \"object\" != typeof a || \"NestedAppAuthResponse\" !== a.messageType) return void r(\"Unrecognized data format received by app, message being ignored. Message: %o\", e);\n  const c = e.source || (null === (t = null == e ? void 0 : e.originalEvent) || void 0 === t ? void 0 : t.source),\n    d = e.origin || (null === (o = null == e ? void 0 : e.originalEvent) || void 0 === o ? void 0 : o.origin);\n  c ? B(c, d) ? (I.topWindow && !I.topWindow.closed && c !== I.topWindow || (I.topWindow = c, I.topOrigin = d), I.topWindow && I.topWindow.closed && (I.topWindow = null, I.topOrigin = null), l(I.topWindow, I.topOrigin, T.topMessageQueue, \"top\"), n(s)) : r(\"Message being ignored by app because it is either coming from the current window or a different window with an invalid origin\") : r(\"Message being ignored by app because it is coming for a target that is null\");\n}\nconst H = k.extend(\"shouldProcessIncomingMessage\");\nfunction B(n, t) {\n  return e(this, void 0, void 0, function* () {\n    if (I.currentWindow && n === I.currentWindow) return H(\"Should not process message because it is coming from the current window\"), !1;\n    if (I.currentWindow && I.currentWindow.location && t && t === I.currentWindow.location.origin) return !0;\n    {\n      let e;\n      try {\n        e = new URL(t);\n      } catch (e) {\n        return H(\"Message has an invalid origin of %s\", t), !1;\n      }\n      const n = yield y(e);\n      return n || H(\"Message has an invalid origin of %s\", t), n;\n    }\n  });\n}\nconst K = k.extend(\"handleIncomingMessageFromParent\");\nfunction G(e, n) {\n  if (n) {\n    const t = [...e].find(([e, t]) => e.toString() === n.toString());\n    if (t) return t[0];\n  }\n}\nfunction X(e, n) {\n  const t = G(n, e.uuid);\n  t && n.delete(t), e.uuid ? T.legacyMessageIdsToUuidMap = {} : delete T.legacyMessageIdsToUuidMap[e.id];\n}\nfunction Y(e) {\n  const n = K,\n    t = W();\n  if (\"id\" in e.data && \"number\" == typeof e.data.id) {\n    const o = e.data,\n      r = w(o),\n      i = function (e) {\n        const n = K;\n        if (!e.uuid) return T.legacyMessageIdsToUuidMap[e.id];\n        {\n          const n = e.uuid,\n            t = G(T.callbacks, n);\n          if (t) return t;\n          const o = G(T.promiseCallbacks, n);\n          if (o) return o;\n          const r = G(T.portCallbacks, n);\n          if (r) return r;\n        }\n        n(\"Received message %s that failed to produce a callbackId\", u(e));\n      }(r);\n    if (i) {\n      const o = T.callbacks.get(i);\n      n(\"Received a response from parent for message %s\", i.toString()), f.handlePerformanceMetrics(i, r, n, t), o && (n(\"Invoking the registered callback for message %s with arguments %o\", i.toString(), r.args), o.apply(null, [...r.args, r.isPartialResponse]), function (e) {\n        return !0 === e.data.isPartialResponse;\n      }(e) || (n(\"Removing registered callback for message %s\", i.toString()), X(r, T.callbacks)));\n      const s = T.promiseCallbacks.get(i);\n      s && (n(\"Invoking the registered promise callback for message %s with arguments %o\", i.toString(), r.args), s(r.args), n(\"Removing registered promise callback for message %s\", i.toString()), X(r, T.promiseCallbacks));\n      const a = T.portCallbacks.get(i);\n      if (a) {\n        let t;\n        n(\"Invoking the registered port callback for message %s with arguments %o\", i.toString(), r.args), e.ports && e.ports[0] instanceof MessagePort && (t = e.ports[0]), a(t, r.args), n(\"Removing registered port callback for message %s\", i.toString()), X(r, T.portCallbacks);\n      }\n      r.uuid && (T.legacyMessageIdsToUuidMap = {});\n    }\n  } else if (\"func\" in e.data && \"string\" == typeof e.data.func) {\n    const o = e.data;\n    f.handleOneWayPerformanceMetrics(o, n, t), n('Received a message from parent %s, action: \"%s\"', u(o), o.func), p(o.func, o.args);\n  } else n(\"Received an unknown message: %O\", e);\n}\nfunction Z() {\n  return I.topWindow !== I.parentWindow;\n}\nfunction ee(e) {\n  return e === I.topWindow && Z() ? T.topMessageQueue : e === I.parentWindow ? T.parentMessageQueue : [];\n}\nfunction ne(e, n) {\n  let t;\n  t = I.currentWindow.setInterval(() => {\n    0 === ee(e).length && (clearInterval(t), n());\n  }, 100);\n}\nexport { I as Communication, A as callFunctionInHost, N as callFunctionInHostAndHandleResponse, E as initializeCommunication, U as requestPortFromParentWithVersion, P as sendAndHandleSdkError, R as sendAndHandleStatusAndReason, C as sendAndHandleStatusAndReasonWithDefaultError, O as sendAndUnwrap, $ as sendMessageToParent, S as sendMessageToParentAsync, L as sendNestedAuthRequestToTopWindow, j as uninitializeCommunication, ne as waitForMessageQueue };","map":{"version":3,"names":["__awaiter","e","isSdkError","n","ErrorCode","t","latestRuntimeApiVersion","o","isSerializable","r","UUID","i","version","s","uninitializeChildCommunication","a","shouldProcessChildMessage","c","handleIncomingMessageFromChild","d","getMessageIdsAsLogString","u","flushMessageQueue","l","GlobalVars","g","callHandler","p","f","serializeMessageRequest","m","deserializeMessageResponse","w","tryPolyfillWithNestedAppAuthBridge","h","getLogger","v","isFollowingApiVersionTagFormat","b","getCurrentTimestamp","W","ssrSafeWindow","M","validateOrigin","y","k","I","T","E","messageListener","data","J","source","originalEvent","origin","B","then","isFramelessWindow","parentWindow","closed","parentOrigin","parentMessageQueue","V","callbacks","set","Y","currentWindow","parent","self","opener","topWindow","top","addEventListener","nativeInterface","Promise","reject","Error","onNativeMessage","S","onMessage","D","sendPostMessage","L","context","clientType","runtimeConfig","clientSupportedSDKVersion","j","removeEventListener","nextMessageId","clear","promiseCallbacks","portCallbacks","legacyMessageIdsToUuidMap","clearMessages","O","R","C","P","uuid","x","map","serialize","N","errorCode","message","validate","deserialize","INTERNAL_ERROR","JSON","stringify","A","U","MessagePort","length","$","Function","Array","topMessageQueue","Map","z","extend","id","func","timestamp","Date","now","monotonicTimestamp","apiVersionTag","args","actionName","F","_","Z","framelessPostMessage","topOrigin","postMessage","ee","push","Q","teamsJsInstanceId","isProxiedFromChild","storeCallbackInformation","name","calledAt","q","parse","messageType","H","location","URL","K","G","find","toString","X","delete","get","handlePerformanceMetrics","apply","isPartialResponse","ports","handleOneWayPerformanceMetrics","ne","setInterval","clearInterval","Communication","callFunctionInHost","callFunctionInHostAndHandleResponse","initializeCommunication","requestPortFromParentWithVersion","sendAndHandleSdkError","sendAndHandleStatusAndReason","sendAndHandleStatusAndReasonWithDefaultError","sendAndUnwrap","sendMessageToParent","sendMessageToParentAsync","sendNestedAuthRequestToTopWindow","uninitializeCommunication","waitForMessageQueue"],"sources":["D:/Project/github-teams/teams-app-new/node_modules/@microsoft/teams-js/dist/esm/packages/teams-js/src/internal/communication.js"],"sourcesContent":["import{__awaiter as e}from\"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";import{isSdkError as n,ErrorCode as t}from\"../public/interfaces.js\";import{latestRuntimeApiVersion as o}from\"../public/runtime.js\";import{isSerializable as r}from\"../public/serializable.interface.js\";import{UUID as i}from\"../public/uuidObject.js\";import{version as s}from\"../public/version.js\";import{uninitializeChildCommunication as a,shouldProcessChildMessage as c,handleIncomingMessageFromChild as d}from\"./childCommunication.js\";import{getMessageIdsAsLogString as u,flushMessageQueue as l}from\"./communicationUtils.js\";import{GlobalVars as g}from\"./globalVars.js\";import{callHandler as p}from\"./handlers.js\";import f from\"./hostToAppTelemetry.js\";import{serializeMessageRequest as m,deserializeMessageResponse as w}from\"./messageObjects.js\";import{tryPolyfillWithNestedAppAuthBridge as h}from\"./nestedAppAuthUtils.js\";import{getLogger as v,isFollowingApiVersionTagFormat as b}from\"./telemetry.js\";import{getCurrentTimestamp as W,ssrSafeWindow as M}from\"./utils.js\";import{validateOrigin as y}from\"./validOrigins.js\";const k=v(\"communication\");class I{}class T{}function E(n,t){if(T.messageListener=n=>function(n){return e(this,void 0,void 0,(function*(){if(!n||!n.data||\"object\"!=typeof n.data)return void J(\"Unrecognized message format received by app, message being ignored. Message: %o\",n);const e=n.source||n.originalEvent&&n.originalEvent.source,t=n.origin||n.originalEvent&&n.originalEvent.origin;return B(e,t).then((o=>{o?(!function(e,n){g.isFramelessWindow||I.parentWindow&&!I.parentWindow.closed&&e!==I.parentWindow||(I.parentWindow=e,I.parentOrigin=n);I.parentWindow&&I.parentWindow.closed&&(I.parentWindow=null,I.parentOrigin=null);l(I.parentWindow,I.parentOrigin,T.parentMessageQueue,\"parent\")}(e,t),e!==I.parentWindow?c(e,t)&&d(n,e,V,((e,n)=>T.callbacks.set(e,n))):Y(n)):J(\"Message being ignored by app because it is either coming from the current window or a different window with an invalid origin, message: %o, source: %o, origin: %o\",n,e,t)}))}))}(n),I.currentWindow=I.currentWindow||M(),I.parentWindow=I.currentWindow.parent!==I.currentWindow.self?I.currentWindow.parent:I.currentWindow.opener,I.topWindow=I.currentWindow.top,(I.parentWindow||n)&&I.currentWindow.addEventListener(\"message\",T.messageListener,!1),!I.parentWindow){const e=I.currentWindow;if(!e.nativeInterface)return Promise.reject(new Error(\"Initialization Failed. No Parent window found.\"));g.isFramelessWindow=!0,e.onNativeMessage=Y}try{return I.parentOrigin=\"*\",S(t,\"initialize\",[s,o,n]).then((([e,n,t,o])=>(h(o,I.currentWindow,{onMessage:D,sendPostMessage:L}),{context:e,clientType:n,runtimeConfig:t,clientSupportedSDKVersion:o})))}finally{I.parentOrigin=null}}function j(){I.currentWindow&&I.currentWindow.removeEventListener(\"message\",T.messageListener,!1),I.currentWindow=null,I.parentWindow=null,I.parentOrigin=null,T.parentMessageQueue=[],T.nextMessageId=0,T.callbacks.clear(),T.promiseCallbacks.clear(),T.portCallbacks.clear(),T.legacyMessageIdsToUuidMap={},f.clearMessages(),a()}function O(e,n,...t){return S(e,n,t).then((([e])=>e))}function R(e,n,...t){return S(e,n,t).then((([e,n])=>{if(!e)throw new Error(n)}))}function C(e,n,t,...o){return S(e,n,o).then((([e,n])=>{if(!e)throw new Error(n||t)}))}function P(e,n,...t){return S(e,n,t).then((([e,n])=>{if(e)throw e;return n}))}function S(e,n,t=void 0){if(!b(e))throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);return new Promise((o=>{const r=V(e,n,t);var i;o((i=r.uuid,new Promise((e=>{T.promiseCallbacks.set(i,e)}))))}))}function x(e){return e.map((e=>r(e)?e.serialize():e))}function N(o,r,i,s,a){var c;return e(this,void 0,void 0,(function*(){const e=x(r),[d]=yield S(s,o,e);if(a&&a(d)||!a&&n(d))throw new Error(`${d.errorCode}, message: ${null!==(c=d.message)&&void 0!==c?c:\"None\"}`);if(i.validate(d))return i.deserialize(d);throw new Error(`${t.INTERNAL_ERROR}, message: Invalid response from host - ${JSON.stringify(d)}`)}))}function A(o,r,i,s){var a;return e(this,void 0,void 0,(function*(){const e=x(r),[c]=yield S(i,o,e);if(s&&s(c)||!s&&n(c))throw new Error(`${c.errorCode}, message: ${null!==(a=c.message)&&void 0!==a?a:\"None\"}`);if(void 0!==c)throw new Error(`${t.INTERNAL_ERROR}, message: Invalid response from host`)}))}function U(e,n,t=void 0){if(!b(e))throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);const o=V(e,n,t);return r=o.uuid,new Promise(((e,n)=>{T.portCallbacks.set(r,((t,o)=>{t instanceof MessagePort?e(t):n(o&&o.length>0?o[0]:new Error(\"Host responded without port or error details.\"))}))}));var r}function $(e,n,t,o){let r;if(t instanceof Function?o=t:t instanceof Array&&(r=t),!b(e))throw Error(`apiVersionTag: ${e} passed in doesn't follow the pattern starting with 'v' followed by digits, then underscore with words, please check.`);const i=V(e,n,r);o&&T.callbacks.set(i.uuid,o)}T.parentMessageQueue=[],T.topMessageQueue=[],T.nextMessageId=0,T.callbacks=new Map,T.promiseCallbacks=new Map,T.portCallbacks=new Map,T.legacyMessageIdsToUuidMap={};const z=k.extend(\"sendNestedAuthRequestToTopWindow\");function L(e,n){const t=z,o=I.topWindow,r=function(e,n){const t=T.nextMessageId++,o=new i;return T.legacyMessageIdsToUuidMap[t]=o,{id:t,uuid:o,func:\"nestedAppAuth.execute\",timestamp:Date.now(),monotonicTimestamp:W(),apiVersionTag:n,args:[],data:e}}(e,n);return t(\"Message %s information: %o\",u(r),{actionName:r.func}),F(o,r)}const _=k.extend(\"sendRequestToTargetWindowHelper\");function F(e,n){const t=_,o=function(e){return e===I.topWindow&&Z()?\"top\":e===I.parentWindow?\"parent\":null}(e),r=m(n);if(g.isFramelessWindow)I.currentWindow&&I.currentWindow.nativeInterface&&(t(\"Sending message %s to %s via framelessPostMessage interface\",u(r),o),I.currentWindow.nativeInterface.framelessPostMessage(JSON.stringify(r)));else{const i=function(e){return e===I.topWindow&&Z()?I.topOrigin:e===I.parentWindow?I.parentOrigin:null}(e);e&&i?(t(\"Sending message %s to %s via postMessage\",u(r),o),e.postMessage(r,i)):(t(\"Adding message %s to %s message queue\",u(r),o),ee(e).push(n))}return n}const Q=k.extend(\"sendMessageToParentHelper\");function V(e,n,t,o,r){const s=Q,a=I.parentWindow,c=function(e,n,t,o,r){const s=T.nextMessageId++,a=new i;T.legacyMessageIdsToUuidMap[s]=a;const c=!0===o?r:g.teamsJsInstanceId;return{id:s,uuid:a,func:n,timestamp:Date.now(),monotonicTimestamp:W(),args:t||[],apiVersionTag:e,isProxiedFromChild:null!=o&&o,teamsJsInstanceId:c}}(e,n,t,o,r);return f.storeCallbackInformation(c.uuid,{name:n,calledAt:c.timestamp}),s(\"Message %s information: %o\",u(c),{actionName:n,args:t}),F(a,c)}const J=k.extend(\"processIncomingMessage\");const q=k.extend(\"processAuthBridgeMessage\");function D(e,n){var t,o;const r=q;if(!e||!e.data||\"object\"!=typeof e.data)return void r(\"Unrecognized message format received by app, message being ignored. Message: %o\",e);const{args:i}=e.data,[,s]=null!=i?i:[],a=(()=>{try{return JSON.parse(s)}catch(e){return null}})();if(!a||\"object\"!=typeof a||\"NestedAppAuthResponse\"!==a.messageType)return void r(\"Unrecognized data format received by app, message being ignored. Message: %o\",e);const c=e.source||(null===(t=null==e?void 0:e.originalEvent)||void 0===t?void 0:t.source),d=e.origin||(null===(o=null==e?void 0:e.originalEvent)||void 0===o?void 0:o.origin);c?B(c,d)?(I.topWindow&&!I.topWindow.closed&&c!==I.topWindow||(I.topWindow=c,I.topOrigin=d),I.topWindow&&I.topWindow.closed&&(I.topWindow=null,I.topOrigin=null),l(I.topWindow,I.topOrigin,T.topMessageQueue,\"top\"),n(s)):r(\"Message being ignored by app because it is either coming from the current window or a different window with an invalid origin\"):r(\"Message being ignored by app because it is coming for a target that is null\")}const H=k.extend(\"shouldProcessIncomingMessage\");function B(n,t){return e(this,void 0,void 0,(function*(){if(I.currentWindow&&n===I.currentWindow)return H(\"Should not process message because it is coming from the current window\"),!1;if(I.currentWindow&&I.currentWindow.location&&t&&t===I.currentWindow.location.origin)return!0;{let e;try{e=new URL(t)}catch(e){return H(\"Message has an invalid origin of %s\",t),!1}const n=yield y(e);return n||H(\"Message has an invalid origin of %s\",t),n}}))}const K=k.extend(\"handleIncomingMessageFromParent\");function G(e,n){if(n){const t=[...e].find((([e,t])=>e.toString()===n.toString()));if(t)return t[0]}}function X(e,n){const t=G(n,e.uuid);t&&n.delete(t),e.uuid?T.legacyMessageIdsToUuidMap={}:delete T.legacyMessageIdsToUuidMap[e.id]}function Y(e){const n=K,t=W();if(\"id\"in e.data&&\"number\"==typeof e.data.id){const o=e.data,r=w(o),i=function(e){const n=K;if(!e.uuid)return T.legacyMessageIdsToUuidMap[e.id];{const n=e.uuid,t=G(T.callbacks,n);if(t)return t;const o=G(T.promiseCallbacks,n);if(o)return o;const r=G(T.portCallbacks,n);if(r)return r}n(\"Received message %s that failed to produce a callbackId\",u(e))}(r);if(i){const o=T.callbacks.get(i);n(\"Received a response from parent for message %s\",i.toString()),f.handlePerformanceMetrics(i,r,n,t),o&&(n(\"Invoking the registered callback for message %s with arguments %o\",i.toString(),r.args),o.apply(null,[...r.args,r.isPartialResponse]),function(e){return!0===e.data.isPartialResponse}(e)||(n(\"Removing registered callback for message %s\",i.toString()),X(r,T.callbacks)));const s=T.promiseCallbacks.get(i);s&&(n(\"Invoking the registered promise callback for message %s with arguments %o\",i.toString(),r.args),s(r.args),n(\"Removing registered promise callback for message %s\",i.toString()),X(r,T.promiseCallbacks));const a=T.portCallbacks.get(i);if(a){let t;n(\"Invoking the registered port callback for message %s with arguments %o\",i.toString(),r.args),e.ports&&e.ports[0]instanceof MessagePort&&(t=e.ports[0]),a(t,r.args),n(\"Removing registered port callback for message %s\",i.toString()),X(r,T.portCallbacks)}r.uuid&&(T.legacyMessageIdsToUuidMap={})}}else if(\"func\"in e.data&&\"string\"==typeof e.data.func){const o=e.data;f.handleOneWayPerformanceMetrics(o,n,t),n('Received a message from parent %s, action: \"%s\"',u(o),o.func),p(o.func,o.args)}else n(\"Received an unknown message: %O\",e)}function Z(){return I.topWindow!==I.parentWindow}function ee(e){return e===I.topWindow&&Z()?T.topMessageQueue:e===I.parentWindow?T.parentMessageQueue:[]}function ne(e,n){let t;t=I.currentWindow.setInterval((()=>{0===ee(e).length&&(clearInterval(t),n())}),100)}export{I as Communication,A as callFunctionInHost,N as callFunctionInHostAndHandleResponse,E as initializeCommunication,U as requestPortFromParentWithVersion,P as sendAndHandleSdkError,R as sendAndHandleStatusAndReason,C as sendAndHandleStatusAndReasonWithDefaultError,O as sendAndUnwrap,$ as sendMessageToParent,S as sendMessageToParentAsync,L as sendNestedAuthRequestToTopWindow,j as uninitializeCommunication,ne as waitForMessageQueue};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}