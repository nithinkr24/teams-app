{"ast":null,"code":"import { __awaiter as e, __rest as i } from \"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";\nimport { sendMessageToParent as r } from \"../internal/communication.js\";\nimport { registerHandler as o } from \"../internal/handlers.js\";\nimport { ensureInitialized as t } from \"../internal/internalAPIs.js\";\nimport { getApiVersionTag as n } from \"../internal/telemetry.js\";\nimport { ssrSafeWindow as d, inServerSideRenderingEnvironment as s } from \"../internal/utils.js\";\nimport { createEffectParameterChangeCallback as a, processMediaStream as f } from \"../internal/videoEffectsUtils.js\";\nimport { VideoPerformanceMonitor as m } from \"../internal/videoPerformanceMonitor.js\";\nimport { FrameContexts as l, errorNotSupportedOnPlatform as c } from \"./constants.js\";\nimport { runtime as v } from \"./runtime.js\";\nconst u = \"v2\",\n  p = s() ? void 0 : new m(r);\nvar F, E, g;\nfunction h(d) {\n  if (t(v, l.sidePanel), !b()) throw c;\n  if (!d.videoFrameHandler || !d.videoBufferHandler) throw new Error(\"Both videoFrameHandler and videoBufferHandler must be provided\");\n  if (o(n(u, \"videoEffects.setFrameProcessTimeLimitHandler\"), \"video.setFrameProcessTimeLimit\", e => null == p ? void 0 : p.setFrameProcessTimeLimit(e.timeLimit), !1), j()) !function (i, d) {\n    if (t(v, l.sidePanel), !b() || !j()) throw c;\n    o(n(u, \"videoEffects.startVideoExtensibilityVideoStreamHandler\"), \"video.startVideoExtensibilityVideoStream\", r => e(this, void 0, void 0, function* () {\n      const {\n          streamId: o\n        } = r,\n        t = function (i, r) {\n          return o => e(this, void 0, void 0, function* () {\n            const e = o.videoFrame;\n            null == r || r.reportStartFrameProcessing(e.codedWidth, e.codedHeight);\n            const t = yield i(o);\n            return null == r || r.reportFrameProcessed(), t;\n          });\n        }(i, p);\n      yield f(o, t, V, p);\n    }), !1), r(n(u, \"videoEffects.mediaStream.registerForVideoFrame\"), \"video.mediaStream.registerForVideoFrame\", [d]);\n  }(d.videoFrameHandler, d.config);else {\n    if (!S()) throw c;\n    !function (e, d) {\n      if (t(v, l.sidePanel), !b() || !S()) throw c;\n      o(n(u, \"videoEffects.registerForVideoBufferHandler\"), \"video.newVideoFrame\", o => {\n        if (o) {\n          const t = o.timestamp;\n          null == p || p.reportStartFrameProcessing(o.width, o.height), e(function (e) {\n            if (\"videoFrameBuffer\" in e) return e;\n            {\n              const {\n                  data: r\n                } = e,\n                o = i(e, [\"data\"]);\n              return Object.assign(Object.assign({}, o), {\n                videoFrameBuffer: r\n              });\n            }\n          }(o), () => {\n            null == p || p.reportFrameProcessed(), function (e) {\n              r(n(u, \"videoEffects.notifyVideoFrameProcessed\"), \"video.videoFrameProcessed\", [e]);\n            }(t);\n          }, V);\n        }\n      }, !1), r(n(u, \"videoEffects.registerForVideoFrame\"), \"video.registerForVideoFrame\", [d]);\n    }(d.videoBufferHandler, d.config);\n  }\n  null == p || p.startMonitorSlowFrameProcessing();\n}\nfunction P(e, i) {\n  if (t(v, l.sidePanel), !b()) throw c;\n  r(n(u, \"videoEffects.notifySelectedVideoEffectChanged\"), \"video.videoEffectChanged\", [e, i]);\n}\nfunction w(e) {\n  if (t(v, l.sidePanel), !b()) throw c;\n  o(n(u, \"videoEffects.registerEffectParameterChangeHandler\"), \"video.effectParameterChange\", a(e, p), !1), r(n(u, \"videoEffects.registerForVideoEffect\"), \"video.registerForVideoEffect\");\n}\nfunction V(e) {\n  r(n(u, \"videoEffects.notifyError\"), \"video.notifyError\", [e]);\n}\nfunction b() {\n  return t(v) && !!v.supports.video && (!!v.supports.video.mediaStream || !!v.supports.video.sharedFrame);\n}\nfunction j() {\n  var e;\n  return t(v, l.sidePanel) && function () {\n    var e, i, r, o;\n    return !(!(null === (i = null === (e = d().chrome) || void 0 === e ? void 0 : e.webview) || void 0 === i ? void 0 : i.getTextureStream) || !(null === (o = null === (r = d().chrome) || void 0 === r ? void 0 : r.webview) || void 0 === o ? void 0 : o.registerTextureStream));\n  }() && !!(null === (e = v.supports.video) || void 0 === e ? void 0 : e.mediaStream);\n}\nfunction S() {\n  var e;\n  return t(v, l.sidePanel) && !!(null === (e = v.supports.video) || void 0 === e ? void 0 : e.sharedFrame);\n}\n!function (e) {\n  e.NV12 = \"NV12\";\n}(F || (F = {})), function (e) {\n  e.EffectChanged = \"EffectChanged\", e.EffectDisabled = \"EffectDisabled\";\n}(E || (E = {})), function (e) {\n  e.InvalidEffectId = \"InvalidEffectId\", e.InitializationFailure = \"InitializationFailure\";\n}(g || (g = {}));\nexport { E as EffectChangeType, g as EffectFailureReason, F as VideoFrameFormat, b as isSupported, P as notifySelectedVideoEffectChanged, w as registerForVideoEffect, h as registerForVideoFrame };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}