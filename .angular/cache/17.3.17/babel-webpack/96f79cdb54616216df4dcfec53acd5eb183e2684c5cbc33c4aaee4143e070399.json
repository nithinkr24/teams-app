{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\nimport { calculateRetryDelay } from \"../util/delay.js\";\nimport { isThrottlingRetryResponse } from \"./throttlingRetryStrategy.js\";\n// intervals are in milliseconds\nconst DEFAULT_CLIENT_RETRY_INTERVAL = 1000;\nconst DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 64;\n/**\n * A retry strategy that retries with an exponentially increasing delay in these two cases:\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails (408, greater or equal than 500, except for 501 and 505).\n */\nexport function exponentialRetryStrategy(options = {}) {\n  var _a, _b;\n  const retryInterval = (_a = options.retryDelayInMs) !== null && _a !== void 0 ? _a : DEFAULT_CLIENT_RETRY_INTERVAL;\n  const maxRetryInterval = (_b = options.maxRetryDelayInMs) !== null && _b !== void 0 ? _b : DEFAULT_CLIENT_MAX_RETRY_INTERVAL;\n  return {\n    name: \"exponentialRetryStrategy\",\n    retry({\n      retryCount,\n      response,\n      responseError\n    }) {\n      const matchedSystemError = isSystemError(responseError);\n      const ignoreSystemErrors = matchedSystemError && options.ignoreSystemErrors;\n      const isExponential = isExponentialRetryResponse(response);\n      const ignoreExponentialResponse = isExponential && options.ignoreHttpStatusCodes;\n      const unknownResponse = response && (isThrottlingRetryResponse(response) || !isExponential);\n      if (unknownResponse || ignoreExponentialResponse || ignoreSystemErrors) {\n        return {\n          skipStrategy: true\n        };\n      }\n      if (responseError && !matchedSystemError && !isExponential) {\n        return {\n          errorToThrow: responseError\n        };\n      }\n      return calculateRetryDelay(retryCount, {\n        retryDelayInMs: retryInterval,\n        maxRetryDelayInMs: maxRetryInterval\n      });\n    }\n  };\n}\n/**\n * A response is a retry response if it has status codes:\n * - 408, or\n * - Greater or equal than 500, except for 501 and 505.\n */\nexport function isExponentialRetryResponse(response) {\n  return Boolean(response && response.status !== undefined && (response.status >= 500 || response.status === 408) && response.status !== 501 && response.status !== 505);\n}\n/**\n * Determines whether an error from a pipeline response was triggered in the network layer.\n */\nexport function isSystemError(err) {\n  if (!err) {\n    return false;\n  }\n  return err.code === \"ETIMEDOUT\" || err.code === \"ESOCKETTIMEDOUT\" || err.code === \"ECONNREFUSED\" || err.code === \"ECONNRESET\" || err.code === \"ENOENT\" || err.code === \"ENOTFOUND\";\n}","map":{"version":3,"names":["calculateRetryDelay","isThrottlingRetryResponse","DEFAULT_CLIENT_RETRY_INTERVAL","DEFAULT_CLIENT_MAX_RETRY_INTERVAL","exponentialRetryStrategy","options","_a","_b","retryInterval","retryDelayInMs","maxRetryInterval","maxRetryDelayInMs","name","retry","retryCount","response","responseError","matchedSystemError","isSystemError","ignoreSystemErrors","isExponential","isExponentialRetryResponse","ignoreExponentialResponse","ignoreHttpStatusCodes","unknownResponse","skipStrategy","errorToThrow","Boolean","status","undefined","err","code"],"sources":["D:/Project/github-teams/teams-app-new/node_modules/@typespec/ts-http-runtime/dist/browser/retryStrategies/exponentialRetryStrategy.js"],"sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\nimport { calculateRetryDelay } from \"../util/delay.js\";\nimport { isThrottlingRetryResponse } from \"./throttlingRetryStrategy.js\";\n// intervals are in milliseconds\nconst DEFAULT_CLIENT_RETRY_INTERVAL = 1000;\nconst DEFAULT_CLIENT_MAX_RETRY_INTERVAL = 1000 * 64;\n/**\n * A retry strategy that retries with an exponentially increasing delay in these two cases:\n * - When there are errors in the underlying transport layer (e.g. DNS lookup failures).\n * - Or otherwise if the outgoing request fails (408, greater or equal than 500, except for 501 and 505).\n */\nexport function exponentialRetryStrategy(options = {}) {\n    var _a, _b;\n    const retryInterval = (_a = options.retryDelayInMs) !== null && _a !== void 0 ? _a : DEFAULT_CLIENT_RETRY_INTERVAL;\n    const maxRetryInterval = (_b = options.maxRetryDelayInMs) !== null && _b !== void 0 ? _b : DEFAULT_CLIENT_MAX_RETRY_INTERVAL;\n    return {\n        name: \"exponentialRetryStrategy\",\n        retry({ retryCount, response, responseError }) {\n            const matchedSystemError = isSystemError(responseError);\n            const ignoreSystemErrors = matchedSystemError && options.ignoreSystemErrors;\n            const isExponential = isExponentialRetryResponse(response);\n            const ignoreExponentialResponse = isExponential && options.ignoreHttpStatusCodes;\n            const unknownResponse = response && (isThrottlingRetryResponse(response) || !isExponential);\n            if (unknownResponse || ignoreExponentialResponse || ignoreSystemErrors) {\n                return { skipStrategy: true };\n            }\n            if (responseError && !matchedSystemError && !isExponential) {\n                return { errorToThrow: responseError };\n            }\n            return calculateRetryDelay(retryCount, {\n                retryDelayInMs: retryInterval,\n                maxRetryDelayInMs: maxRetryInterval,\n            });\n        },\n    };\n}\n/**\n * A response is a retry response if it has status codes:\n * - 408, or\n * - Greater or equal than 500, except for 501 and 505.\n */\nexport function isExponentialRetryResponse(response) {\n    return Boolean(response &&\n        response.status !== undefined &&\n        (response.status >= 500 || response.status === 408) &&\n        response.status !== 501 &&\n        response.status !== 505);\n}\n/**\n * Determines whether an error from a pipeline response was triggered in the network layer.\n */\nexport function isSystemError(err) {\n    if (!err) {\n        return false;\n    }\n    return (err.code === \"ETIMEDOUT\" ||\n        err.code === \"ESOCKETTIMEDOUT\" ||\n        err.code === \"ECONNREFUSED\" ||\n        err.code === \"ECONNRESET\" ||\n        err.code === \"ENOENT\" ||\n        err.code === \"ENOTFOUND\");\n}\n"],"mappings":"AAAA;AACA;AACA,SAASA,mBAAmB,QAAQ,kBAAkB;AACtD,SAASC,yBAAyB,QAAQ,8BAA8B;AACxE;AACA,MAAMC,6BAA6B,GAAG,IAAI;AAC1C,MAAMC,iCAAiC,GAAG,IAAI,GAAG,EAAE;AACnD;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,wBAAwBA,CAACC,OAAO,GAAG,CAAC,CAAC,EAAE;EACnD,IAAIC,EAAE,EAAEC,EAAE;EACV,MAAMC,aAAa,GAAG,CAACF,EAAE,GAAGD,OAAO,CAACI,cAAc,MAAM,IAAI,IAAIH,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGJ,6BAA6B;EAClH,MAAMQ,gBAAgB,GAAG,CAACH,EAAE,GAAGF,OAAO,CAACM,iBAAiB,MAAM,IAAI,IAAIJ,EAAE,KAAK,KAAK,CAAC,GAAGA,EAAE,GAAGJ,iCAAiC;EAC5H,OAAO;IACHS,IAAI,EAAE,0BAA0B;IAChCC,KAAKA,CAAC;MAAEC,UAAU;MAAEC,QAAQ;MAAEC;IAAc,CAAC,EAAE;MAC3C,MAAMC,kBAAkB,GAAGC,aAAa,CAACF,aAAa,CAAC;MACvD,MAAMG,kBAAkB,GAAGF,kBAAkB,IAAIZ,OAAO,CAACc,kBAAkB;MAC3E,MAAMC,aAAa,GAAGC,0BAA0B,CAACN,QAAQ,CAAC;MAC1D,MAAMO,yBAAyB,GAAGF,aAAa,IAAIf,OAAO,CAACkB,qBAAqB;MAChF,MAAMC,eAAe,GAAGT,QAAQ,KAAKd,yBAAyB,CAACc,QAAQ,CAAC,IAAI,CAACK,aAAa,CAAC;MAC3F,IAAII,eAAe,IAAIF,yBAAyB,IAAIH,kBAAkB,EAAE;QACpE,OAAO;UAAEM,YAAY,EAAE;QAAK,CAAC;MACjC;MACA,IAAIT,aAAa,IAAI,CAACC,kBAAkB,IAAI,CAACG,aAAa,EAAE;QACxD,OAAO;UAAEM,YAAY,EAAEV;QAAc,CAAC;MAC1C;MACA,OAAOhB,mBAAmB,CAACc,UAAU,EAAE;QACnCL,cAAc,EAAED,aAAa;QAC7BG,iBAAiB,EAAED;MACvB,CAAC,CAAC;IACN;EACJ,CAAC;AACL;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASW,0BAA0BA,CAACN,QAAQ,EAAE;EACjD,OAAOY,OAAO,CAACZ,QAAQ,IACnBA,QAAQ,CAACa,MAAM,KAAKC,SAAS,KAC5Bd,QAAQ,CAACa,MAAM,IAAI,GAAG,IAAIb,QAAQ,CAACa,MAAM,KAAK,GAAG,CAAC,IACnDb,QAAQ,CAACa,MAAM,KAAK,GAAG,IACvBb,QAAQ,CAACa,MAAM,KAAK,GAAG,CAAC;AAChC;AACA;AACA;AACA;AACA,OAAO,SAASV,aAAaA,CAACY,GAAG,EAAE;EAC/B,IAAI,CAACA,GAAG,EAAE;IACN,OAAO,KAAK;EAChB;EACA,OAAQA,GAAG,CAACC,IAAI,KAAK,WAAW,IAC5BD,GAAG,CAACC,IAAI,KAAK,iBAAiB,IAC9BD,GAAG,CAACC,IAAI,KAAK,cAAc,IAC3BD,GAAG,CAACC,IAAI,KAAK,YAAY,IACzBD,GAAG,CAACC,IAAI,KAAK,QAAQ,IACrBD,GAAG,CAACC,IAAI,KAAK,WAAW;AAChC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}