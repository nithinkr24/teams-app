{"ast":null,"code":"import { __awaiter as e } from \"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";\nimport { sendMessageToParent as r } from \"../internal/communication.js\";\nimport { registerHandler as i } from \"../internal/handlers.js\";\nimport { ensureInitialized as o } from \"../internal/internalAPIs.js\";\nimport { getApiVersionTag as t } from \"../internal/telemetry.js\";\nimport { inServerSideRenderingEnvironment as n } from \"../internal/utils.js\";\nimport { createEffectParameterChangeCallback as d, processMediaStreamWithMetadata as s, processMediaStream as a } from \"../internal/videoEffectsUtils.js\";\nimport { VideoPerformanceMonitor as f } from \"../internal/videoPerformanceMonitor.js\";\nimport { errorNotSupportedOnPlatform as m, FrameContexts as c } from \"../public/constants.js\";\nimport { runtime as l } from \"../public/runtime.js\";\nimport { isSupported as v } from \"../public/videoEffects.js\";\nconst u = \"v2\",\n  p = 2e3,\n  E = n() ? void 0 : new f(r);\nvar F;\nfunction g(n) {\n  var d, f;\n  if (!x()) throw m;\n  if (!n.videoFrameHandler || !n.videoBufferHandler) throw new Error(\"Both videoFrameHandler and videoBufferHandler must be provided\");\n  if (o(l, c.sidePanel)) {\n    if (i(t(u, \"videoEffectsEX.registerSetFrameProcessTimeLimitHandler\"), \"video.setFrameProcessTimeLimit\", e => null == E ? void 0 : E.setFrameProcessTimeLimit(e), !1), null === (d = l.supports.video) || void 0 === d ? void 0 : d.mediaStream) i(t(u, \"videoEffectsEX.registerStartVideoExtensibilityVideoStreamHandler\"), \"video.startVideoExtensibilityVideoStream\", r => e(this, void 0, void 0, function* () {\n      const {\n          streamId: i,\n          metadataInTexture: o\n        } = r,\n        t = E ? function (r, i) {\n          return o => e(this, void 0, void 0, function* () {\n            const e = o.videoFrame;\n            i.reportStartFrameProcessing(e.codedWidth, e.codedHeight);\n            const t = h(),\n              n = yield r(o);\n            return t(), i.reportFrameProcessed(), n;\n          });\n        }(n.videoFrameHandler, E) : n.videoFrameHandler;\n      o ? yield s(i, t, y, E) : yield a(i, t, y, E);\n    }), !1), r(t(u, \"videoEffectsEX.mediaStream.registerForVideoFrame\"), \"video.mediaStream.registerForVideoFrame\", [n.config]);else {\n      if (!(null === (f = l.supports.video) || void 0 === f ? void 0 : f.sharedFrame)) throw m;\n      i(t(u, \"videoEffectsEx.registerNewVideoFrameHandler\"), \"video.newVideoFrame\", e => {\n        if (e) {\n          null == E || E.reportStartFrameProcessing(e.width, e.height);\n          const i = h(),\n            o = e.timestamp;\n          n.videoBufferHandler(function (e) {\n            return e.videoFrameBuffer = e.videoFrameBuffer || e.data, delete e.data, e;\n          }(e), () => {\n            i(), null == E || E.reportFrameProcessed(), function (e) {\n              r(t(u, \"videoEffectsEx.notifyVideoFrameProcessed\"), \"video.videoFrameProcessed\", [e]);\n            }(o);\n          }, y);\n        }\n      }, !1), r(t(u, \"videoEffectsEx.registerForVideoFrame\"), \"video.registerForVideoFrame\", [n.config]);\n    }\n    null == E || E.startMonitorSlowFrameProcessing();\n  }\n}\nfunction h() {\n  const e = setTimeout(() => {\n    y(`Frame not processed in ${p}ms`, F.Warn);\n  }, p);\n  return function () {\n    clearTimeout(e);\n  };\n}\nfunction P(e, i, n) {\n  if (o(l, c.sidePanel), !x()) throw m;\n  r(t(u, \"videoEffectsEx.notifySelectedVideoEffectChanged\"), \"video.videoEffectChanged\", [e, i, n]);\n}\nfunction w(e) {\n  if (o(l, c.sidePanel), !x()) throw m;\n  i(t(u, \"videoEffectsEx.registerEffectParamterChangeHandler\"), \"video.effectParameterChange\", d(e, E), !1), r(t(u, \"videoEffectsEx.registerForVideoEffect\"), \"video.registerForVideoEffect\");\n}\nfunction V(e) {\n  if (o(l, c.sidePanel), !v()) throw m;\n  r(t(u, \"videoEffectsEx.updatePersonalizedEffects\"), \"video.personalizedEffectsChanged\", [e]);\n}\nfunction x() {\n  return o(l), v();\n}\nfunction y(e, i = F.Warn) {\n  r(t(u, \"videoEffectsEx.notifyError\"), \"video.notifyError\", [e, i]);\n}\nfunction H(e) {\n  if (o(l), !v()) throw m;\n  y(e, F.Fatal);\n}\n!function (e) {\n  e.Fatal = \"fatal\", e.Warn = \"warn\";\n}(F || (F = {}));\nexport { F as ErrorLevel, p as frameProcessingTimeoutInMs, x as isSupported, H as notifyFatalError, P as notifySelectedVideoEffectChanged, w as registerForVideoEffect, g as registerForVideoFrame, V as updatePersonalizedEffects };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}